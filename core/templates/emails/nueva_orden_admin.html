<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Nueva Orden #{{ orden.id }}</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f4f4f4; padding: 20px; }
        .container { max-width: 700px; margin: auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 0 15px rgba(0,0,0,0.1); }
        h1 { color: #d32f2f; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: #f0f0f0; }
        .total { font-size: 1.4em; font-weight: bold; color: #2e7d32; }
        .footer { margin-top: 30px; font-size: 0.9em; color: #666; }
    </style>
</head>
<body>
<div class="container">
    <h1>NUEVA ORDEN #{{ orden.id }} Requiere atención inmediata!</h1>
    
    <p><strong>Cliente:</strong> {{ cliente }}</p>
    <p><strong>Teléfono:</strong> {{ orden.usuario.perfil.telefono|default:"No indicado" }}</p>
    <p><strong>Email:</strong> {{ orden.usuario.email }}</p>
    <p><strong>Fecha:</strong> {{ orden.fecha|date:"d/m/Y H:i" }}</p>
    <p><strong>Método de pago:</strong> {{ orden.get_metodo_pago_display }}</p>
    <p><strong>Envío:</strong> 
        {% if orden.direccionenvio.metodo == 'domicilio' %}
            Domicilio ({{ orden.direccionenvio.comuna }})
        {% else %}
            Retiro en local
        {% endif %}
    </p>

    <h2>Productos</h2>
    <table>
        <thead>
            <tr>
                <th>Producto</th>
                <th>Cant.</th>
                <th>Precio</th>
                <th>Subtotal</th>
            </tr>
        </thead>
        <tbody>
        {% for item in items %}
            <tr>
                <td>{{ item.producto.nombre }}</td>
                <td>{{ item.cantidad }}</td>
                <td>${{ item.precio|intcomma }}</td>
                <td>${{ item.cantidad|mul:item.precio|intcomma }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <p class="total">TOTAL: ${{ orden.total|intcomma }}</p>

    {% if orden.comprobante %}
        <p><strong>Comprobante adjunto</strong> (transferencia)</p>
    {% endif %}

    <div class="footer">
        <p>Ir al panel → <a href="https://distribuidora-talagante.onrender.com/panel/">Panel Admin</a></p>
        <p>¡No responder este correo!</p>
    </div>
</div>
</body>
</html>
